<html>
<head>
  <script type="text/javascript" src="jquery.js">
  //from: http://code.google.com/apis/libraries/devguide.html#jquery
  //min: https://ajax.googleapis.com/ajax/libs/jquery/1.5.2/jquery.min.js
  </script>
  <script type="text/javascript" src="ICanHaz.js">
    //Super-simple mustache templating.
    //from: https://github.com/andyet/ICanHaz.js/
    //min: https://github.com/andyet/ICanHaz.js/raw/master/ICanHaz.min.js
  </script>
  <!--
  //These will most likely be quite helpful in querying the api
  <script type="text/javascript" src="underscore.js">
    //from: http://documentcloud.github.com/underscore/
  </script>
  <script type="text/javascript" src="backbone.js">
  //from: http://documentcloud.github.com/backbone/
  //min: http://documentcloud.github.com/backbone/backbone-min.js
  </script>
  -->
  <script type="text/javascript" src="date.js">
  //Date parsing and formatting.
  //from: http://www.datejs.com/
  </script>
  <script id="meetupEventView" type="text/html">
  <div class="meetup">
    <div class="descript">
      <h2>{{name}}</h2>
      {{{description}}}
    </div>
    <div class="date_time">
      <h3>{{day}}</h3>
      <h4>{{hour}}</h4>
      <h5>{{rsvps}} rsvp</h5>
    </div>
  </div>
  </script>
  <script id="MeetupAPI" type="text/javascript">

  function MeetupAPI(){};
  MeetupAPI.prototype = {
    dependencies: {
      iCanHaz: ["https://github.com/andyet/ICanHaz.js/raw/master/ICanHaz.min.js", "ICanHaz.js"],
      date: ["date.js"],
      jquery: ["https://ajax.googleapis.com/ajax/libs/jquery/1.5.2/jquery.min.js", "jquery.js"]
    },
    
    get: function(){
      $.getJSON("api/meetup.json", this.onCollect);
    },
    
    onCollect: function(meetupFeed){
      $(document).ready(function(){ //Woo hoops to jump through.
        Meetup.collection = meetupFeed;
        this.render();
      });
    },
    
    parseMeetup: function(data){
      //"Tue May 24 19:00:00 EDT 2011" -> "May 24 19:00:00"
      var date_chomped = data["time"].split(" ").slice(1,4).join(" ");
      var date = Date.parse(date_chomped);
      var meetupData= {
       rsvps: data["rsvpcount"],
       day: date.toString("M/d"),
       hour: date.toString("h:mmp"),
       description: data["description"], // Use {{{}}} because this has inline html
       name: data["name"]
      };
      return meetupData;
    },

    render: function(){
      var meetupContainer = $("#lc"); //pull this out into the constructor
      var meetupViews = $.map(MeetupAPI.collection["results"], function(apiEventData){
        return meetupContainer.append(ich.meetupEventView(parseMeetup(apiEventData)));
      });
    }
  };
  </script>
  <script type="text/javascript" src="meetup.json">
  //I don't expect we'll need to do this kind of jsonp-style include in production, but for local testing, you can't do "file://" ajax requests.
  //So this include, and the previous call-point are the main differences in the test files vs the main files.
  </script>
</head>
<body>
  <div class="head">
  <h1 id="logo"><a href="test.html">BmoreJS.info</a></h1>
  </div>
  <div id="content">
    <div id="lc">
    </div><!-- end lc -->
  </div>
</body>
</html>
